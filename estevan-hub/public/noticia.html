<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artigo | Estevan Hub</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'lunar': {
              50: '#f0f7ff', 100: '#e0efff', 200: '#bae3ff', 300: '#7cd0ff',
              400: '#36baff', 500: '#0ca5f1', 600: '#0284ce', 700: '#0369a1',
              800: '#075985', 900: '#0c4a6e', 950: '#082f49'
            },
            'night': {
              50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
              400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
              800: '#1e293b', 900: '#0f172a', 950: '#020617'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-night-100 min-h-screen text-night-900">
  <!-- Header igual à index -->
  <header class="bg-night-900/80 backdrop-blur-xl shadow-2xl border-b border-lunar-800/50 sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <a href="/" class="flex items-center group cursor-pointer">
          <div class="bg-gradient-to-r from-lunar-400 to-lunar-600 w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all duration-300">
            <i data-lucide="zap" class="w-6 h-6 text-white"></i>
          </div>
          <span class="ml-3 text-3xl font-bold text-gradient">Estevan Hub</span>
        </a>
        <div class="hidden md:flex space-x-8 items-center">
          <a href="/#simulador" class="text-lunar-200 hover:text-lunar-400 transition-all duration-300">Simulador</a>
          <a href="/#servicos" class="text-lunar-200 hover:text-lunar-400 transition-all duration-300">Serviços</a>
          <a href="/#portfolio" class="text-lunar-200 hover:text-lunar-400 transition-all duration-300">Portfolio</a>
          <a href="/#contato" class="btn-primary text-white px-6 py-3 rounded-full">
            <i data-lucide="send" class="w-4 h-4 inline mr-2"></i>
            Contato
          </a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Conteúdo do artigo -->
  <main class="py-16 bg-white">
    <div class="max-w-3xl w-full mx-auto px-4 sm:px-6 lg:px-8">
      <article id="articleContainer" class="rounded-3xl shadow-xl bg-white">
        <!-- Carregando... -->
        <div class="text-center p-20">
          <div class="inline-block animate-spin mb-6">
            <i data-lucide="loader-2" class="w-12 h-12 text-lunar-400"></i>
          </div>
          <p class="text-lunar-400">Carregando artigo...</p>
        </div>
      </article>

      <!-- Artigos relacionados -->
      <section class="mt-20">
        <h3 class="text-2xl font-bold text-night-900 mb-8 flex items-center">
          <i data-lucide="book-open" class="w-6 h-6 text-lunar-400 mr-3"></i>
          Artigos Relacionados
        </h3>
        <div id="relatedArticles" class="grid md:grid-cols-3 gap-8"></div>
      </section>
    </div>
  </main>

  <!-- Footer igual à index -->
  <footer class="bg-night-900/70 border-t border-lunar-800/20 py-12 mt-20">
    <div class="container mx-auto px-4">
      <div class="text-center">
        <p class="text-lunar-400">&copy; 2024 Estevan Hub. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <script>
    // Pega o slug da URL
    const slug = window.location.pathname.split('/').pop();

    // Carrega o artigo
    async function loadArticle() {
      try {
        const response = await fetch(`/api/publications/${slug}`);
        if (!response.ok) throw new Error('Artigo não encontrado');
        const article = await response.json();
        renderArticle(article);
        document.title = `${article.titulo} | Estevan Hub`;
        loadRelatedArticles(article.categoria);
      } catch (error) {
        document.getElementById('articleContainer').innerHTML = `
          <div class="text-center p-20">
            <i data-lucide="file-question" class="w-16 h-16 text-lunar-600 mx-auto mb-6"></i>
            <h2 class="text-2xl font-bold text-night-900 mb-4">Artigo não encontrado</h2>
            <p class="text-lunar-400 mb-8">O artigo que você está procurando não está disponível.</p>
            <a href="/" class="btn-primary text-white px-6 py-3 rounded-xl">
              <i data-lucide="home" class="w-4 h-4 inline mr-2"></i>
              Voltar à página inicial
            </a>
          </div>
        `;
        if (typeof lucide !== 'undefined') lucide.createIcons();
      }
    }

    // Renderiza o artigo
    function renderArticle(article) {
      let thumb = article.thumbnail
        ? `<img src="/uploads/${article.thumbnail}" alt="${article.titulo}" class="w-full h-64 object-cover rounded-t-3xl mb-6">`
        : (article.imagem_destaque
            ? `<img src="${article.imagem_destaque}" alt="${article.titulo}" class="w-full h-64 object-cover rounded-t-3xl mb-6">`
            : '');

      const html = `
        ${thumb}
        <div class="px-6 pt-2 pb-8">
          <div class="flex items-center gap-3 mb-4">
            <div>
              <div class="font-bold text-lunar-400 text-sm uppercase">${article.categoria || ''}</div>
              <div class="text-xs text-lunar-400">${article.data_formatada || ''}</div>
            </div>
          </div>
          <h1 class="text-4xl font-bold text-night-900 mb-4">${article.titulo}</h1>
          <div class="flex flex-wrap gap-6 mb-8 text-sm text-night-700">
            <span class="flex items-center gap-2">
              <i data-lucide="user" class="w-4 h-4 text-lunar-400"></i>
              ${article.autor || 'Equipe Estevan Hub'}
            </span>
            <span class="flex items-center gap-2">
              <i data-lucide="tag" class="w-4 h-4 text-lunar-400"></i>
              ${article.categoria || ''}
            </span>
          </div>
          <div class="prose prose-lg max-w-none text-night-900 article-content">
            ${article.conteudo || article.resumo || ''}
          </div>
        </div>
      `;
      document.getElementById('articleContainer').innerHTML = html;
      if (typeof lucide !== 'undefined') lucide.createIcons();
    }

    // Carrega artigos relacionados
    async function loadRelatedArticles(categoria) {
      try {
        const response = await fetch('/api/publications');
        if (!response.ok) throw new Error('Erro ao carregar artigos relacionados');
        const articles = await response.json();
        let relatedArticles = articles.filter(a => a.categoria === categoria && a.slug !== slug).slice(0, 3);
        if (relatedArticles.length === 0) {
          relatedArticles = articles.filter(a => a.slug !== slug).slice(0, 3);
        }
        renderRelatedArticles(relatedArticles);
      } catch (error) {
        document.getElementById('relatedArticles').innerHTML = `
          <div class="col-span-3 text-center py-8">
            <p class="text-lunar-400">Não foi possível carregar artigos relacionados.</p>
          </div>
        `;
      }
    }

    // Renderiza artigos relacionados
    function renderRelatedArticles(articles) {
      if (articles.length === 0) {
        document.getElementById('relatedArticles').innerHTML = `
          <div class="col-span-3 text-center py-8">
            <p class="text-lunar-400">Nenhum artigo relacionado disponível.</p>
          </div>
        `;
        return;
      }
      const html = articles.map(article => {
        return `
          <div class="bg-night-800/80 p-6 rounded-2xl border border-lunar-700/50 group hover:border-lunar-400/70 transition-all duration-300 shadow-lg flex flex-col h-full">
            ${article.thumbnail ? `<img src="/uploads/${article.thumbnail}" class="w-full h-32 object-cover rounded-xl mb-4" />` : ''}
            <div class="flex items-center gap-3 mb-3">
              <div class="text-xs text-lunar-400">${article.data_formatada || ''}</div>
            </div>
            <h5 class="font-bold text-white mb-2 text-lg group-hover:text-lunar-400 transition-colors">
              <a href="/noticia/${article.slug}" class="hover:underline">${article.titulo}</a>
            </h5>
            <p class="text-lunar-200 text-sm mb-4 flex-1">${article.resumo ? article.resumo.substring(0, 120) + '...' : ''}</p>
            <a href="/noticia/${article.slug}" class="text-lunar-400 hover:underline font-semibold mt-auto flex items-center gap-1">
              <i data-lucide="arrow-right" class="w-4 h-4"></i> Ver mais
            </a>
          </div>
        `;
      }).join('');
      document.getElementById('relatedArticles').innerHTML = html;
      if (typeof lucide !== 'undefined') lucide.createIcons();
    }

    document.addEventListener('DOMContentLoaded', loadArticle);
  </script>
  <style>
    body {
      background: #f8fafc;
      color: #222;
    }
    .article-content h1, .article-content h2, .article-content h3, .article-content h4 {
      color: #0c4a6e;
      font-weight: bold;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    .article-content p {
      margin-bottom: 1.5rem;
    }
    .article-content a {
      color: #0ca5f1;
      text-decoration: underline;
    }
    .prose img, .article-content img {
      border-radius: 1rem;
      margin: 2rem auto;
      max-width: 100%;
      height: auto;
      display: block;
    }
    @media (max-width: 900px) {
      .max-w-3xl {
        max-width: 100vw !important;
      }
      .rounded-3xl {
        border-radius: 0 !important;
      }
      .px-6 {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
      }
    }
    #relatedArticles .bg-night-800\/80 {
      background: rgba(30,41,59,0.85) !important;
      border: 1px solid #334155 !important;
      box-shadow: 0 4px 24px 0 rgba(54,186,255,0.10);
      transition: border 0.2s;
    }
    #relatedArticles .group:hover {
      border-color: #36baff !important;
    }
    #relatedArticles h5 a {
      color: #fff;
      text-decoration: none;
      transition: color 0.2s;
    }
    #relatedArticles h5 a:hover {
      color: #36baff;
      text-decoration: underline;
    }
    #relatedArticles .text-lunar-400 {
      color: #36baff !important;
    }
    #relatedArticles .text-lunar-200 {
      color: #bae3ff !important;
    }
  </style>
</body>
</html>
